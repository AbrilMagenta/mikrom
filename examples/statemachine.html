<!doctype html>
<html>
  <head>
    <title>Basic Mikrom</title>
    <link rel="stylesheet" href="assets/styles.css">
  </head>
  
  <body>
    
    <div class="wrapper">
      <div class="menu">
        <a app-href="home">Home</a>
        <a app-href="page2">Another page</a>
        <a app-href="page3">Some other page</a>
        <a app-href="page4">A third page</a>
      </div>
      
      <div app-if="page==home">
        <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit. Facere accusamus nemo rem necessitatibus, esse amet ullam eveniet asperiores. Mollitia atque temporibus qui modi veniam culpa aspernatur, sint consequatur dolore at!</p>
        <p><img src="http://lorempixel.com/400/200" alt=""></p>
      </div>
      <div app-if="page==page2">
        <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit. Facilis in modi, odio sint repellendus alias reprehenderit voluptatem architecto quod, possimus ex iste neque facere quae eius vitae debitis doloremque error.Lorem ipsum dolor sit amet, consectetur adipisicing elit. Facere accusamus nemo rem necessitatibus, esse amet ullam eveniet asperiores. Mollitia atque temporibus qui modi veniam culpa aspernatur, sint consequatur dolore at!</p>
        <p><img src="http://lorempixel.com/350/200" alt=""></p>
      </div>
      <div app-if="page==page3">This is the home page3</div>
      <div app-if="page==page4">This is the home page4</div>
    </div>
      
    <script src="../dist/mikrom.js"></script>
    <script>
      var State = {
        watchers: [],
        vars: {},
        dirty: true,
        
        varFromString: function(string) {
          var arr = string.split('.');
          var test = arr.shift();

          var nested = State.vars[test];

          if (arr.length > 0) {
            return State.nestedFromString(arr.join("."), nested);
          }else {
            return nested;
          }
        },
        set(v, value) {
          State.vars[v] = value;
          State.dirty = true;
        },
        loop: function() {
          requestAnimationFrame(State.loop);
          if (State.dirty) State.update();
        },
        update: function() {
          State.dirty = false;
          mikrom.trigger("state.update");
        }
      }
      
      var StateAnimation = {
        library: {},
        add: function(name, callback) {
          StateAnimation[name] = callback;
        }
      }
      
      mikrom.component("[app-href]", function(el, attr) {
        console.log("I'm HERE")
        el.addEventListener("click", function() {
          State.set("page", attr.appHref);
        })
      })
      
      mikrom.component("[app-if]", function(el, attr) {
        var varName = attr.appIf.split("==")[0];
        var val = attr.appIf.split("==")[1];
        
        mikrom.on("state.update", function() {
          var v = State.varFromString(varName);

          if (v == val) {
            el.style.display = "";
          }else{
            el.style.display = "none";
          }
        })
      });
      
      mikrom.init();
      
      State.set("page", "home");
      State.loop();
    </script>
  </body>
</html>